<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Techlog</title>
    <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
    <script type="module" src="firebase/Components/firebase.js"></script>
    <script type="module" src="firebase/Components/auth.js"></script>
    <script type="module" src="firebase/Components/device.js"></script>
  </head>
  <body>
    <div id="cards">
      <h3>CARD PAGE</h3>
      <div id="card-nav">
        <nav class="navbar navbar-default">
          <div class="container-fluid">
            <div class="navbar-header">
              <a class="navbar-brand">WebSiteName</a> 
              <!-- PUT LOGO HERE^^^^^^^^^^^^^^^ -->
            </div>
            <ul class="nav navbar-nav">
              <li class="active"><a href="../../index.html">Home</a></li>
              <li id="back"><a href="../../devices.html">Back</a></li>
              <li id="home"><a href="#">Home</a></li>
              <li id="signOut"><button id="signOutButton">Sign Out</button></li>
            </ul>
          </div>
        </nav>
      </div>

      <div id="computerAttributes">
        <!-- Display computer attributes here -->
        <p>CPU: <input type="text" id="cpu" ></p>
        <p>RAM: <input type="text" id="ram" ></p>
        <p>Computer Type: <input type="text" id="computerType" ></p>
        <p>Model: <input type="text" id="model" ></p>
      </div>

      <button id="editButton">Edit</button>
      <button id="saveButton" style="display: none;">Save</button>
      <button id="homeButton">Back to Home</button>

      <script type="module">
        import { getComputerDetails, saveUpdate } from './firebase/Components/device.js';
      
        // Add event listener for the "Back to Home" button
        const homeButton = document.getElementById("homeButton");
        homeButton.addEventListener("click", () => {
          window.location.href = "../../index.html";
        });
      
        document.addEventListener("DOMContentLoaded", async () => {
          const params = new URLSearchParams(window.location.search);
          const key = params.get("key");
          const locationKey = params.get("lkey");
          const computerKey = params.get("ckey");
          const clientName = params.get("client");
          const locationName = params.get("location");
          const computerName = params.get("computer");
      
          console.log("Values passed into function: ", clientName, locationName, computerName);
          // Use the extracted information to fetch and display computer details
          const computerDetails = await getComputerDetails(clientName, locationName, computerName);
          console.log("Computer Details(in card.html):", computerDetails);
      
          // Display computer attributes on the page
          if (computerDetails) {
            const cpuElement = document.getElementById("cpu");
            const ramElement = document.getElementById("ram");
            const computerTypeElement = document.getElementById("computerType");
            const modelElement = document.getElementById("model");
            const editButton = document.getElementById("editButton");
            const saveButton = document.getElementById("saveButton");
      
            // Set initial values
            cpuElement.value = computerDetails.cpu;
            ramElement.value = computerDetails.ram;
            computerTypeElement.value = computerDetails.computerType;
            modelElement.value = computerDetails.model;
      
            // Function to toggle edit mode
            const toggleEditMode = () => {

              const isEditing = cpuElement.readOnly;
              // Works backwards for some reason, doesn't work without the !
              cpuElement.readOnly = !isEditing;
              ramElement.readOnly = !isEditing;
              computerTypeElement.readOnly = !isEditing;
              modelElement.readOnly = !isEditing;
      
              // Show/hide the "Save" and "Cancel" buttons based on the edit mode
              saveButton.style.display = isEditing ? "block" : "none";
              editButton.innerText = isEditing ? "Cancel" : "Edit";
            };
      
            editButton.addEventListener("click", toggleEditMode);
    
            saveButton.addEventListener("click", async () => {
              
              saveUpdate(key, locationKey, computerKey, cpuElement.value, ramElement.value, computerTypeElement.value, modelElement.value);

              // Toggle back to read-only mode
              toggleEditMode();
            });
      
            // Initially set the form to read-only mode
            toggleEditMode();
          } else {
            // Handle the case where computer details are not available
            console.error("Computer details not available");
          }
        });
      </script>
    </div>
    <script>
      $(function(){
        $("#nav-placeholder").load("navbar.html");
      });
    </script>
  </body>
</html>
