<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Techlog</title>
    <script type="module" src="firebase/Components/firebase.js"></script>
    <script type="module" src="firebase/Components/auth.js"></script>
    <script type="module" src="firebase/Components/device.js"></script>
  </head>
  <body>
    <div id="cards">
      <h3>CARD PAGE</h3>

      <div id="computerAttributes">
        <!-- Display computer attributes here -->
        <p>CPU: <input type="text" id="cpu" ></p>
        <p>RAM: <input type="text" id="ram" ></p>
        <p>Computer Type: <input type="text" id="computerType" ></p>
        <p>Model: <input type="text" id="model" ></p>
      </div>

      <button id="editButton">Edit</button>
      <button id="saveButton" style="display: none;">Save</button>
      <button id="homeButton">Back to Home</button>

      <script type="module">
        import { getComputerDetails } from './firebase/Components/device.js';
      
        // Add event listener for the "Back to Home" button
        const homeButton = document.getElementById("homeButton");
        homeButton.addEventListener("click", () => {
          window.location.href = "../../index.html";
        });
      
        document.addEventListener("DOMContentLoaded", async () => {
          const params = new URLSearchParams(window.location.search);
          const clientName = params.get("client");
          const locationName = params.get("location");
          const computerName = params.get("computer");
      
          console.log("Values passed into function: ", clientName, locationName, computerName);
          // Use the extracted information to fetch and display computer details
          const computerDetails = await getComputerDetails(clientName, locationName, computerName);
          console.log("Computer Details(in card.html):", computerDetails);
      
          // Display computer attributes on the page
          if (computerDetails) {
            const cpuElement = document.getElementById("cpu");
            const ramElement = document.getElementById("ram");
            const computerTypeElement = document.getElementById("computerType");
            const modelElement = document.getElementById("model");
            const editButton = document.getElementById("editButton");
            const saveButton = document.getElementById("saveButton");
      
            // Set initial values
            cpuElement.value = computerDetails.cpu;
            ramElement.value = computerDetails.ram;
            computerTypeElement.value = computerDetails.computerType;
            modelElement.value = computerDetails.model;
      
            // Function to toggle edit mode
            const toggleEditMode = () => {
              console.log("CPU READ is " + cpuElement.readOnly);
              console.log("RAM READ is " + ramElement.readOnly);
              console.log("COMPUTER TYPE READ is " + computerTypeElement.readOnly);
              console.log("MODEL READ is " + modelElement.readOnly);

              const isEditing = cpuElement.readOnly;
              // Works backwards for some reason, doesn't work without the !
              console.log("isEditing is " + isEditing);
              cpuElement.readOnly = !isEditing;
              ramElement.readOnly = !isEditing;
              computerTypeElement.readOnly = !isEditing;
              modelElement.readOnly = !isEditing;
      
              // Show/hide the "Save" and "Cancel" buttons based on the edit mode
              saveButton.style.display = isEditing ? "block" : "none";
              editButton.innerText = isEditing ? "Cancel" : "Edit";
            };
      
            editButton.addEventListener("click", toggleEditMode);
    
            saveButton.addEventListener("click", async () => {
              // Implement logic to update the database with the new values
              const updatedDetails = {
                cpu: cpuElement.value,
                ram: ramElement.value,
                computerType: computerTypeElement.value,
                model: modelElement.value,
              };
      
              // Implement the function to update the database with the new values
              // For now, logs the updated details
              console.log("Updated Details:", updatedDetails);
      
              // Toggle back to read-only mode
              toggleEditMode();
            });
      
            // Initially set the form to read-only mode
            toggleEditMode();
          } else {
            // Handle the case where computer details are not available
            console.error("Computer details not available");
          }
        });
      </script>
      
    </div>
  </body>
</html>
